Initial study setup
*******************
:order: 410

A study raw dataset contains all raw data and metadata on a study, across
all acquisitions and participants. It is typically created just prior the
first (pilot) acquisition.  Its purpose is to record all data in their raw,
unaltered form, as provided by the respective acquisition machinery.
Moreover, it is used to bind data from multiple acquisition sources (e.g.
MRI, eye tracker, ECG) together, to create a reliable record of what data
were recorded at which point on what hardware. Importantly, this also includes
the logs of any stimulation setup, or behavior responses that are typically
generated by paradigm implementations provided by individual researchers.

*The study raw dataset should capture all information required to reproduce
any subsequently performed data analyses.*


Preparation
-----------
Start off by installing https://github.com/psychoinformatics-de/cbbs-imaging-container-import,
which also provides additional tools apart from sheer creation:
``datalad install -s https://github.com/psychoinformatics-de/cbbs-imaging-container-import [INSTALL-DIR]``

After successful installation run the following command to retrieve the actual container image:
``datalad get INSTALL-DIR/cbbs-imaging.simg``

Dataset creation
----------------
To create a study dataset you just need to run:
``singularity run INSTALL-DIR/cbbs-imaging.simg create [TARGET-DIR]``.
If you don't provide a target dir, the dataset will be created in the current working directory.

Adding an MRI session
---------------------

The above mentioned container also provides a command to import a tarball for a session.
This will result in a subdataset with the DICOMs in it, that provides the DICOM metadata for easy access via `datalad`.

To import such a tarball just run
``singularity run [--bind=/path/to/tarball] INSTALL-DIR/cbbs-imaging.simg import [TARBALL]``
from within your study dataset. You don't need to be at its root directory, but you need to make sure, you aren't accidentally in a subdataset. Therefore the study dataset's root is a safe practice to follow.

Note, that TARBALL needs to be an absolute path at the moment.
Particularly if TARBALL is located outside your HOME directory, you may need to provide its location to the container via the `--bind` option.


A session name like `af29_0678` will be derived from the dicoms' metadata and a subdirectory with that is created.
In that subdirectory you should then find a `studyspec.json`, which is needed for conversion later on and a subdirectory `dicoms`, which is in fact a subdataset containing the actual dicoms.
