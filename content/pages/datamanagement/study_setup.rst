Initial study setup
*******************
:order: 410

A study raw dataset contains all raw data and metadata on a study, across
all acquisitions and participants. It is typically created just prior the
first (pilot) acquisition.  Its purpose is to record all data in their raw,
unaltered form, as provided by the respective acquisition machinery.
Moreover, it is used to bind data from multiple acquisition sources (e.g.
MRI, eye tracker, ECG) together, to create a reliable record of what data
were recorded at which point on what hardware. Importantly, this also includes
the logs of any stimulation setup, or behavior responses that are typically
generated by paradigm implementations provided by individual researchers.

*The study raw dataset should capture all information required to reproduce
any subsequently performed data analyses.*


A study raw dataset is supposed to have a subdirectory for each acquisition. The
name of this directory is the acquisition identifier as far as the tools
described here are concerned. Each of those acquisition directories should
contain all relevant data of an acquisition. Most notably they contain a
subdataset `dicoms` and a `specification file <{filename}study_specification.rst>`_
to curate required information for `conversion <{filename}conversion.rst>`_ . It
is recommended to group other data according to its source and nature similarly
(i.e. have a `physio` subdirectory alongside the `dicoms` subdirectory).
The study raw dataset should also contain custom code needed for conversion in
order to provide reproducibility.

Preparation
-----------

Data management relies on `datalad <https://github.com/datalad/datalad>`_ and
`datalad-hirni <https://github.com/psychoinformatics-de/datalad-hirni>`_
respectively, which is an extension to datalad to provide additional
functionality for this platform.
Start off by `installing datalad-hirni <https://github.com/psychoinformatics-de/datalad-hirni#installation>`_.


Dataset creation
----------------
To create a study dataset you just need to run::

  datalad rev-create [TARGET-DIR]

If you don't provide a target dir, the dataset will be created in the current
working directory. This will create an empty datalad dataset.

To preconfigure it to be a *study dataset* however, you need to run a dedicated
setup procedure from within the dataset::

  cd [TARGET-DIR]
  datalad run-procedure setup_hirni_dataset

This command will do several things to make this a study dataset.
Apart from setting some configurations like enabling the extraction of DICOM metadata, it will create a default README file, a dataset_description.json template file, an initial study specification file and it will install hirni's `toolbox dataset <{filename}tools/toolbox.rst>`_ as a subdataset of `my_raw_dataset`.
Note, that by default the toolbox is installed from github. If you need to install from elsewhere, you can set the `datalad.hirni.toolbox.url` config to point to another URL prior to running ``setup_hirni_dataset``.

You can now use hirni's `webUI <{filename}tools/webui.rst>`_ to edit the study metadata and thereby fill the ``dataset_description.json`` file.
This step can be postponed or repeated later on to complete it. There's no technical need to fill it out completely (or at all) at this point. It is recommended to do it as far as you can though.

The dataset is now ready for `importing <{filename}import_dicoms.rst>`_ acquisition data.

For more details and an example of such a setup, see the respective `demo <{filename}demo_study.rst>`_.
